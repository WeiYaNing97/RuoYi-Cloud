<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.example.mapper.ExampleUsersVOMapper">

    <resultMap id="UserWithNestedData" type="ExampleUsersVO">
        <result property="exampleId" column="example_id"/>
        <result property="username" column="username"/>
        <result property="email" column="email"/>
        <result property="passwordHash" column="password_hash"/>
        <result property="phone" column="phone"/>
        <result property="avatarUrl" column="avatar_url"/>
        <result property="role" column="role"/>
        <result property="isActive" column="is_active"/>
        <result property="lastLogin" column="last_login"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <collection property="exampleOrdersVOs" ofType="ExampleOrdersVO">
            <!--<result property="exampleId" column="example_id"/>-->
            <result property="exampleUserId" column="example_user_id"/>
            <result property="orderDate" column="order_date"/>
            <result property="totalAmount" column="total_amount"/>
            <result property="status" column="status"/>
            <result property="shippingAddress" column="shipping_address"/>
            <result property="shippingMethod" column="shipping_method"/>
            <result property="paymentMethod" column="payment_method"/>
            <result property="trackingNumber" column="tracking_number"/>
            <result property="remark" column="remark"/>
            <result property="createdAt" column="created_at"/>
            <result property="updatedAt" column="updated_at"/>
            <collection property="exampleOrderItemsVOs" ofType="ExampleOrderItemsVO">
                <!--<result property="exampleId" column="example_id"/>-->
                <result property="exampleOrderId" column="example_order_id"/>
                <result property="exampleProductId" column="example_product_id"/>
                <result property="quantity" column="quantity"/>
                <result property="unitPrice" column="unit_price"/>
                <result property="totalPrice" column="total_price"/>
                <result property="productName" column="product_name"/>
                <result property="sku" column="sku"/>
                <result property="status" column="status"/>
                <collection property="exampleProductsVOs" ofType="ExampleProductsVO">
                    <!--<result property="exampleId" column="example_id"/>-->
                    <result property="productName" column="product_name"/>
                    <result property="description" column="description"/>
                    <result property="price" column="price"/>
                    <result property="exampleCategoryId" column="example_category_id"/>
                    <result property="stockQuantity" column="stock_quantity"/>
                    <result property="status" column="status"/>
                    <result property="sku" column="sku"/>
                    <result property="imageUrl" column="image_url"/>
                    <result property="createdAt" column="created_at"/>
                    <result property="updatedAt" column="updated_at"/>
                </collection>
            </collection>
        </collection>
    </resultMap>

    <select id="selectUserProductsList" resultMap="UserWithNestedData">
        SELECT
            *
        FROM
            example_users
                LEFT JOIN example_orders ON example_users.example_id = example_orders.example_user_id
                LEFT JOIN example_order_items ON example_orders.example_id = example_order_items.example_order_id
                LEFT JOIN example_products ON example_order_items.example_product_id = example_products.example_id
    </select>
</mapper>